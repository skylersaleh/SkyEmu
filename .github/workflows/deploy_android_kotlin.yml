name: Build Android Kotlin
on: [push,pull_request,workflow_dispatch]
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    env:
      CMAKE_VERSION: 3.18.1
      NDK_VERSION: 22.1.7171670
      
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v4
        
      - name: Setup Ninja 
        uses: seanmiddleditch/gha-setup-ninja@master
        
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin' # See 'Supported distributions' for available options
          java-version: '17'
          
      - name: Set up cache
        uses: actions/cache@v4.2.0
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
            ${{ github.workspace }}/.ccache
          key: ${{ runner.os }}-android-${{ github.sha }}
          restore-keys: |
            ${{ runner.os }}-android-

      - name: Install CMake & Android NDK
        run: echo "yes" | $ANDROID_HOME/tools/bin/sdkmanager "cmake;${{ env.CMAKE_VERSION }}" "ndk;${{ env.NDK_VERSION }}" --channel=3 | grep -v = || true
            
      - name: Build Release apk
        run: |
          sudo apt-get install ccache
          export NDK_CCACHE=$(which ccache)
          cd tools/android_project_kotlin/
          chmod +x ./gradlew && ./gradlew assembleRelease
          ls app/build/outputs/apk/release/
          ccache -s -v
          
      - name: GH Release üöÄ
        # You may pin to the exact commit or the version.
        uses: actions/upload-artifact@v4
        with:
           name: AndroidRelease
           path: tools/android_project_kotlin/app/build/outputs/apk/release/com.sky.SkyEmu-*-release.apk
        
 
